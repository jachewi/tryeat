<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">

<head th:replace="fragments/header :: header"></head>

<body>
<!-- ======= Header ======= -->
<div th:replace="fragments/body-header :: body-header" id="header" class="fixed-top d-flex align-items-center"></div>

<!-- ======= Section ======= -->
<section class="common item item-detail">
  <div class="container">
    <div class="admin-btn" sec:authorize="hasRole('ROLE_ADMIN')">
      <!-- ê´€ë¦¬ìì—ê²Œë§Œ ë³´ì´ëŠ” ë²„íŠ¼ -->
      <a th:href="@{/items/{id}/update (id=${itemResponseDto.id})}" class="btn btn-outline-dark" role="button">ìƒí’ˆ ìˆ˜ì •</a>
      <form th:action="@{/items/{id}/delete (id=${itemResponseDto.id})}" method="post">
        <button type="submit" class="btn btn-outline-danger">ìƒí’ˆ ì‚­ì œ</button>
      </form>
    </div>

    <div class="row gy-4">
      <div class="item-img col-lg-7">
        <img th:src="@{${itemResponseDto.mainImage}}" class="main-img">
      </div>
      <div class="item-info col-lg-5">
        <h2 th:text="${itemResponseDto.name}">ìƒí’ˆ ì´ë¦„</h2>
        <hr/>
        <table>
          <th>price</th>
          <td>
            <span th:text="${itemResponseDto.price}">ìƒí’ˆ ê°€ê²©</span>ì›
          </td>
        </table>

        <div class="order-info">
          <input type="hidden" id="itemId" th:value="${itemResponseDto.id}">
          <div class="quantity">
            <label for="quantity">ìˆ˜ëŸ‰</label>
            <input type="number" id="quantity" min="1" value="1">
          </div>
          <hr/>
          <div class="order-click">
            <button type="button" id="addCartItem" class="btn btn-custom" value="ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°">Add Cart</button>
            <button type="button" id="order-btn" class="btn btn-custom">Buy Now</button>
          </div>
        </div>

        <!-- ì£¼ë¬¸ form -->
        <form th:action="@{/payment}" method="get" class="order-form">
          <input type="hidden" name="payments[0].itemId" th:value="${itemResponseDto.id}">
          <input type="hidden" name="payments[0].quantity" value="">
        </form>
      </div>
    </div>
  </div> <!-- /container -->
</section>

<!-- ======= Footer ======= -->
<div th:replace="fragments/footer :: footer"></div>

<!-- ======= Js ======= -->
<script th:inline="javascript">
  /* ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸° */
  $('#addCartItem').click(function() {
    var url = "/carts";
    var data = {
      itemId : $('#itemId').val(),
      quantity : $('#quantity').val()
    };

    $.ajax({
      type: "POST",
      url: url,
      data: data,
      statusCode: {
        200: function(result) {
          alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
        },
        201: function(result) {
          alert("ì¥ë°”êµ¬ë‹ˆì— ìƒí’ˆì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.ğŸ›’");
        }
      },
      error: function(jqXHR) {
        alert(jqXHR.responseText);
      }
    });
  });

  /* ë°”ë¡œ ì£¼ë¬¸í•˜ê¸° */
  $("#order-btn").click(function() {
    let quantity = $("#quantity").val();

    $(".order-form").find('input[name="payments[0].quantity"]').val(quantity);
    $(".order-form").submit();
  });


</script>
</body>

</html>
